# 04-04. NTP 시간 동기화

> CCNA 200-301 레벨 네트워크 엔지니어 면접 시나리오
> 주제: 시간 동기화 필요성, NTP 서버/클라이언트 설정, Stratum 개념, 검증 명령어, NTP 인증, 타임존 설정

---

### 면접관: "네트워크 장비의 시간이 정확하지 않으면 어떤 문제가 발생할 수 있습니까? 시간 동기화가 왜 중요한지 설명해주세요."

네트워크 장비의 시간 동기화는 생각보다 많은 영역에 영향을 미치는 중요한 요소입니다.

**1. 로그 분석과 장애 대응**
- 네트워크 장애가 발생했을 때, 여러 장비의 로그를 시간 순서대로 분석해야 합니다.
- 장비 간 시간이 다르면 이벤트의 인과관계를 파악할 수 없습니다.
- 예를 들어, 라우터 A에서 09:15에 링크 다운이 발생하고, 스위치 B에서 09:17에 경로 변경이 일어났다면, 이 두 이벤트의 시간이 정확해야 원인-결과 관계를 확인할 수 있습니다.

**2. 인증서 및 보안**
- SSL/TLS 인증서는 유효 기간이 있습니다. 장비 시간이 틀리면 유효한 인증서를 만료된 것으로 판단하거나, 만료된 인증서를 유효한 것으로 판단할 수 있습니다.
- Kerberos 인증은 기본적으로 5분 이상의 시간 차이를 허용하지 않습니다.

**3. 규정 준수(Compliance)**
- 금융, 의료 등 규제 산업에서는 정확한 로그 타임스탬프가 법적 요구사항입니다.
- 감사(audit) 시 시간이 일관되지 않은 로그는 증거로 인정되지 않을 수 있습니다.

**4. 프로토콜 동작**
- 일부 라우팅 프로토콜이나 보안 프로토콜은 타임스탬프 기반으로 동작합니다.
- DNSSEC, OSPF 인증 등에서 시간 정확성이 중요합니다.

---

### 면접관: "NTP의 Stratum 개념을 설명해주세요. Stratum 값이 의미하는 것은 무엇입니까?"

**NTP(Network Time Protocol)**에서 **Stratum**은 시간 소스의 정확도 계층을 나타내는 숫자입니다.

```
Stratum 0: 원자 시계, GPS 수신기 (실제 시간 소스 장비 - NTP에 직접 참여하지 않음)
    │
Stratum 1: Stratum 0에 직접 연결된 NTP 서버 (Primary Time Server)
    │
Stratum 2: Stratum 1에 동기화된 NTP 서버
    │
Stratum 3: Stratum 2에 동기화된 NTP 서버
    │
  ...
Stratum 15: NTP에서 허용하는 최대 계층
Stratum 16: 동기화되지 않음 (Unsynchronized)
```

| Stratum | 설명 | 정확도 |
|---------|------|--------|
| 0 | 원자 시계, GPS (참조 시계) | 최고 정확도 |
| 1 | Stratum 0에 직접 연결 | 매우 높음 |
| 2 | Stratum 1에서 시간 수신 | 높음 |
| 3-15 | 상위 Stratum에서 시간 수신 | 계층이 높을수록 약간의 오차 증가 |
| 16 | 동기화되지 않음 | 사용 불가 |

핵심 포인트는 다음과 같습니다.
- Stratum 값이 낮을수록 시간 소스에 가까우므로 더 정확합니다.
- NTP 클라이언트는 여러 NTP 서버 중 Stratum 값이 낮은 서버를 우선 선택합니다.
- 최대 Stratum은 15이며, 16은 "동기화되지 않음"을 의미합니다.

일반적인 기업 환경에서는 공인 Stratum 1-2 서버(예: time.google.com, pool.ntp.org)를 사용하고, 내부 NTP 서버를 Stratum 3으로 운영하는 구조가 일반적입니다.

---

### 면접관: "Cisco 라우터를 NTP 클라이언트로 설정하는 방법을 보여주세요."

#### 핵심 설정

```
! 타임존 설정 (한국 표준시 KST = UTC+9)
Router(config)# clock timezone KST 9

! NTP 서버 지정 (클라이언트로 동작)
Router(config)# ntp server 216.239.35.0
Router(config)# ntp server 216.239.35.4

! (선택) NTP 소스 인터페이스 지정
Router(config)# ntp source Loopback0
```

여러 NTP 서버를 지정하면 NTP 알고리즘이 가장 정확한 서버를 자동으로 선택합니다. `ntp source`는 NTP 패킷의 출발지 인터페이스를 지정하는 것으로, Loopback 인터페이스를 사용하면 물리 인터페이스 장애와 무관하게 NTP가 동작합니다.

#### 검증 명령어

```
! 현재 시계 확인
Router# show clock
09:30:45.123 KST Mon Feb 9 2026

! NTP 동기화 상태 확인
Router# show ntp status
Clock is synchronized, stratum 3, reference is 216.239.35.0
nominal freq is 250.0000 Hz, actual freq is 250.0000 Hz, precision is 2**18
reference time is E7A1B2C3.4D5E6F70 (09:25:30.302 KST Mon Feb 9 2026)
clock offset is 0.5234 msec, root delay is 25.34 msec
root dispersion is 15.67 msec, peer dispersion is 3.45 msec
loopfilter state is 'CTRL' (Normal Controlled Loop),
drift compensation is 0.000000123 s/s

! NTP 피어(연결된 서버) 정보 확인
Router# show ntp associations

  address         ref clock       st   when   poll reach  delay  offset   disp
*~216.239.35.0   .GPS.            1    45     64   377    25.3   0.52     3.4
+~216.239.35.4   .GPS.            1    32     64   377    28.1   1.23     4.1
```

`show ntp associations` 출력에서 중요한 기호를 설명하면 다음과 같습니다.
- `*` : 현재 동기화 중인 서버 (System Peer)
- `+` : 후보 서버 (Candidate)
- `-` : 제외된 서버 (Outlyer)
- `~` : 동적으로 설정된 서버

---

### 면접관: "내부 라우터를 NTP 서버로도 동작하게 하여, 다른 네트워크 장비들이 이 라우터에서 시간을 받도록 하고 싶습니다. 어떻게 설정합니까?"

내부 NTP 계층 구조를 만드는 설정입니다.

```
! 코어 라우터: 외부 NTP 서버와 동기화 + 내부 NTP 서버 역할
CoreRouter(config)# ntp server 216.239.35.0
CoreRouter(config)# ntp server 216.239.35.4
CoreRouter(config)# ntp master 3
```

`ntp master 3`은 이 라우터를 Stratum 3 NTP 서버로 설정합니다. 외부 NTP 서버(Stratum 1)에서 시간을 받아 Stratum 3으로 동작하며, 내부 장비들은 이 라우터에서 시간을 받으면 Stratum 4가 됩니다.

```
! 내부 스위치/라우터: 코어 라우터에서 시간 수신
AccessSwitch(config)# ntp server 10.0.0.1    ← CoreRouter의 IP

! 설정 후 확인
AccessSwitch# show ntp status
Clock is synchronized, stratum 4, reference is 10.0.0.1
```

이렇게 계층적으로 구성하면 외부 NTP 서버에 대한 연결이 일시적으로 끊어져도, 코어 라우터가 자체 시계를 기반으로 내부 장비에 시간을 제공할 수 있습니다.

---

### 면접관: "NTP 인증은 왜 필요하고, 어떻게 설정합니까?"

NTP 인증이 없으면 악의적인 공격자가 가짜 NTP 서버를 설치하여 장비의 시간을 조작할 수 있습니다. 시간이 조작되면 다음과 같은 문제가 발생합니다.

- 로그 타임스탬프 왜곡으로 보안 사고 추적 불가
- 인증서 유효성 검증 우회
- 시간 기반 보안 메커니즘 무력화

#### NTP 인증 설정

```
! NTP 서버 측 설정
NTPServer(config)# ntp authenticate
NTPServer(config)# ntp authentication-key 1 md5 SecureNTP123
NTPServer(config)# ntp trusted-key 1
NTPServer(config)# ntp master 2

! NTP 클라이언트 측 설정
Client(config)# ntp authenticate
Client(config)# ntp authentication-key 1 md5 SecureNTP123
Client(config)# ntp trusted-key 1
Client(config)# ntp server 10.0.0.1 key 1
```

설정을 단계별로 설명하면 다음과 같습니다.

| 명령어 | 설명 |
|--------|------|
| `ntp authenticate` | NTP 인증 기능 활성화 |
| `ntp authentication-key 1 md5 SecureNTP123` | 키 번호 1에 MD5 비밀번호 설정 |
| `ntp trusted-key 1` | 키 번호 1을 신뢰할 수 있는 키로 지정 |
| `ntp server 10.0.0.1 key 1` | 서버 연결 시 키 1을 사용하여 인증 |

서버와 클라이언트 양쪽의 키 번호와 비밀번호가 일치해야 NTP 동기화가 이루어집니다.

---

### 면접관: "타임존과 서머타임(DST) 설정은 어떻게 합니까?"

#### 타임존 설정

```
! 한국 표준시 (KST = UTC+9)
Router(config)# clock timezone KST 9

! 미국 동부 표준시 (EST = UTC-5)
Router(config)# clock timezone EST -5
```

#### 서머타임(DST) 설정 (한국은 사용하지 않지만 미국 등에서 필요)

```
! 미국 동부 서머타임 설정
Router(config)# clock timezone EST -5
Router(config)# clock summer-time EDT recurring 2 Sunday March 2:00 1 Sunday November 2:00
```

이 설정은 3월 두 번째 일요일 02:00부터 11월 첫 번째 일요일 02:00까지 EDT(Eastern Daylight Time, UTC-4)를 적용합니다.

#### 수동 시계 설정 (NTP 없이 직접 설정)

```
Router# clock set 09:30:00 Feb 9 2026
```

하지만 수동 설정은 시간이 지나면서 드리프트(drift)가 발생하므로, 반드시 NTP를 사용하는 것을 권장합니다. 일반적인 장비의 시계는 하루에 수 초의 오차가 발생할 수 있어, NTP 없이는 한 달이면 수 분의 차이가 생길 수 있습니다.

---

### 면접관: "NTP 트러블슈팅 시 확인해야 할 사항들을 정리해주세요."

NTP 동기화가 되지 않을 때 확인해야 할 항목들입니다.

#### 진단 절차

```
! 1단계: NTP 상태 확인
Router# show ntp status
→ "Clock is unsynchronized"이면 동기화 실패

! 2단계: NTP 피어 상태 확인
Router# show ntp associations
→ reach 값이 0이면 서버와 통신 불가

! 3단계: NTP 서버 연결 확인
Router# ping 216.239.35.0
→ 기본 연결성 확인

! 4단계: NTP 패킷 디버그
Router# debug ntp events
```

#### 자주 발생하는 문제와 해결 방법

| 문제 | 원인 | 해결 방법 |
|------|------|----------|
| reach 값이 0 | 방화벽이 UDP 123 차단 | ACL/방화벽에서 UDP 123 허용 |
| stratum 16 표시 | 서버와 동기화 안 됨 | NTP 서버 주소 확인, 네트워크 경로 확인 |
| offset이 매우 큼 | 시간 차이가 너무 큼 | 수동으로 시간을 먼저 대략 맞춘 후 NTP 재시도 |
| 인증 실패 | 키 불일치 | 양쪽 키 번호와 비밀번호 확인 |
| 동기화 지연 | NTP 초기 수렴 시간 | 최초 동기화에 5~15분 소요, 대기 필요 |

`show ntp associations`의 **reach** 값은 8비트 시프트 레지스터로, 최근 8번의 폴링 결과를 8진수로 표시합니다. 377(8진수)은 최근 8번 모두 성공을 의미하고, 0은 한 번도 응답을 받지 못한 것입니다.
