# 04-03. DNS 동작 원리

> CCNA 200-301 레벨 네트워크 엔지니어 면접 시나리오
> 주제: DNS 해석 프로세스, 레코드 타입, DNS 계층 구조, Cisco DNS 설정, nslookup/dig, DNS 캐싱, TTL

---

### 면접관: "사용자가 브라우저에 www.example.com을 입력했을 때, 실제로 해당 웹사이트에 접속하기까지 DNS 측면에서 어떤 과정이 일어납니까?"

사용자가 www.example.com을 입력하면 다음과 같은 DNS 해석(Resolution) 과정이 진행됩니다.

**1단계 - 로컬 캐시 확인**
PC는 먼저 자신의 DNS 캐시에 해당 도메인의 IP가 있는지 확인합니다. Windows에서는 `ipconfig /displaydns`로 확인할 수 있습니다.

**2단계 - 로컬 DNS 서버(Recursive Resolver)에 질의**
캐시에 없으면, PC에 설정된 DNS 서버(보통 ISP DNS 또는 8.8.8.8 같은 공용 DNS)에 **재귀적 질의(Recursive Query)**를 보냅니다. 재귀적 질의란 "최종 답을 반드시 돌려달라"는 요청입니다.

**3단계 - DNS 계층 구조 탐색 (Iterative Query)**
로컬 DNS 서버가 캐시에 답이 없으면, 스스로 **반복적 질의(Iterative Query)**를 통해 답을 찾습니다.

```
클라이언트 → 로컬 DNS 서버 (Recursive Query)
  로컬 DNS → Root DNS 서버       → "com. 네임서버는 여기야"
  로컬 DNS → TLD(.com) DNS 서버  → "example.com 네임서버는 여기야"
  로컬 DNS → Authoritative DNS   → "www.example.com의 IP는 93.184.216.34야"
로컬 DNS 서버 → 클라이언트 (최종 응답: 93.184.216.34)
```

**4단계 - 응답 캐싱**
로컬 DNS 서버는 이 결과를 TTL(Time To Live) 동안 캐싱하여, 같은 질의가 오면 다시 계층 탐색 없이 바로 응답합니다.

---

### 면접관: "방금 재귀적 질의와 반복적 질의를 언급했는데, 이 두 가지의 차이를 좀 더 명확하게 설명해주세요."

| 구분 | 재귀적 질의 (Recursive) | 반복적 질의 (Iterative) |
|------|----------------------|----------------------|
| 요청자 | 클라이언트 → 로컬 DNS 서버 | 로컬 DNS 서버 → 상위 DNS 서버들 |
| 응답 | 최종 답변(IP 주소)을 반드시 반환 | "다음에 물어볼 서버"를 알려줌 (referral) |
| 부하 | 로컬 DNS 서버가 모든 탐색 수행 | 각 서버는 자기가 아는 범위만 응답 |
| 책임 | 로컬 DNS 서버가 답을 찾아야 할 의무 | 상위 서버는 방향만 안내 |

쉽게 비유하면, 재귀적 질의는 "이 도메인의 IP를 찾아서 알려줘"라고 전적으로 맡기는 것이고, 반복적 질의는 "나는 모르지만 이 서버한테 물어봐"라고 힌트를 주는 것입니다.

클라이언트는 보통 재귀적 질의만 하고, 로컬 DNS 서버가 나머지 반복적 질의를 수행하여 답을 찾아줍니다.

---

### 면접관: "DNS에는 다양한 레코드 타입이 있습니다. 주요 레코드 타입을 설명해주세요."

실무에서 자주 접하는 DNS 레코드 타입은 다음과 같습니다.

| 레코드 타입 | 기능 | 예시 |
|------------|------|------|
| **A** | 도메인 → IPv4 주소 매핑 | www.example.com → 93.184.216.34 |
| **AAAA** | 도메인 → IPv6 주소 매핑 | www.example.com → 2606:2800:220:1:... |
| **CNAME** | 도메인 → 다른 도메인 별칭 | blog.example.com → www.example.com |
| **MX** | 메일 서버 지정 | example.com → mail.example.com (우선순위 10) |
| **PTR** | IP 주소 → 도메인 (역방향) | 93.184.216.34 → www.example.com |
| **NS** | 도메인의 네임서버 지정 | example.com → ns1.example.com |
| **SOA** | 도메인 영역의 권한 정보 | 시리얼 번호, 갱신 주기 등 |
| **TXT** | 텍스트 정보 저장 | SPF, DKIM 등 메일 인증에 활용 |

**A 레코드**가 가장 기본적이며, 웹사이트 접속 시 사용됩니다. **CNAME**은 CDN 서비스에서 많이 사용되는데, 예를 들어 `cdn.example.com`을 `d1234.cloudfront.net`으로 매핑하는 식입니다.

**PTR 레코드**는 역방향 조회(Reverse DNS)에 사용되며, 메일 서버의 스팸 방지 검증에서 중요한 역할을 합니다.

---

### 면접관: "DNS 계층 구조에서 Root 서버, TLD 서버, 권한 있는 서버의 역할을 설명해주세요."

DNS는 트리 형태의 계층 구조로 구성되어 있습니다.

```
            . (Root)
           / | \
        com  net  org  kr  ...    ← TLD (Top-Level Domain)
        /
    example                        ← Second-Level Domain
      /
    www                            ← Subdomain (호스트명)
```

**Root DNS 서버 (.)**
- 전 세계에 13개의 루트 서버 그룹(A~M)이 있으며, Anycast로 수백 개의 미러 서버가 분산 운영됩니다.
- TLD 서버의 위치를 알려주는 역할을 합니다.
- "com.은 이 TLD 서버들이 관리한다"는 정보를 반환합니다.

**TLD DNS 서버 (.com, .net, .kr 등)**
- 각 최상위 도메인을 관리합니다.
- 해당 TLD 아래 등록된 도메인의 권한 있는 네임서버 위치를 알려줍니다.
- "example.com은 이 Authoritative 서버가 관리한다"는 정보를 반환합니다.

**Authoritative DNS 서버**
- 특정 도메인에 대한 최종 권한을 가진 서버입니다.
- 실제 A, MX, CNAME 등의 레코드를 저장하고 있습니다.
- "www.example.com의 IP는 93.184.216.34이다"라는 최종 답변을 제공합니다.

---

### 면접관: "Cisco 라우터에서 DNS 관련 설정은 어떻게 합니까?"

Cisco 라우터에서 DNS 클라이언트 및 기본 설정 방법은 다음과 같습니다.

#### 핵심 설정

```
! DNS 서버 지정 (라우터가 DNS 클라이언트로 사용할 서버)
Router(config)# ip name-server 8.8.8.8
Router(config)# ip name-server 8.8.4.4

! DNS 조회 활성화 (기본값은 활성화)
Router(config)# ip domain-lookup

! 기본 도메인 이름 설정
Router(config)# ip domain-name company.local

! 정적 호스트 매핑 (DNS 없이 이름 해석)
Router(config)# ip host server1 192.168.1.100
Router(config)# ip host server2 192.168.1.200
```

설정 후 검증은 다음과 같이 합니다.

```
! 라우터에서 이름 해석 테스트
Router# ping www.example.com
Translating "www.example.com"...domain server (8.8.8.8) [OK]

! DNS 캐시 확인
Router# show hosts
Default Domain is company.local
Name/address lookup uses domain service
Name servers are 8.8.8.8, 8.8.4.4

Host        Port  Flags      Age  Type   Address(es)
server1     ---   (perm, OK)  0   IP     192.168.1.100
server2     ---   (perm, OK)  0   IP     192.168.1.200
```

주의할 점으로, `ip domain-lookup`이 활성화된 상태에서 CLI에 잘못된 명령어를 입력하면 라우터가 이를 호스트 이름으로 인식하여 DNS 조회를 시도하고, 이 과정에서 몇 초간 대기하게 됩니다. 이를 방지하려면 `no ip domain-lookup`으로 비활성화하거나, `line con 0`에서 `transport preferred none`을 설정합니다.

---

### 면접관: "nslookup이나 dig 도구를 사용해서 DNS 문제를 진단하는 방법을 알려주세요."

DNS 트러블슈팅에 자주 사용하는 도구를 설명드리겠습니다.

#### nslookup (Windows/Linux/Mac 공통)

```
! 기본 조회
C:\> nslookup www.example.com
Server:  dns.google
Address:  8.8.8.8

Non-authoritative answer:
Name:    www.example.com
Address:  93.184.216.34

! 특정 DNS 서버를 지정하여 조회
C:\> nslookup www.example.com 1.1.1.1

! 레코드 타입 지정 조회
C:\> nslookup -type=MX example.com
C:\> nslookup -type=NS example.com
```

#### dig (Linux/Mac - 더 상세한 정보 제공)

```
$ dig www.example.com

; <<>> DiG 9.16.1 <<>> www.example.com
;; ANSWER SECTION:
www.example.com.    3600    IN    A    93.184.216.34

;; Query time: 25 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)

! 특정 레코드 타입 조회
$ dig MX example.com
$ dig NS example.com

! 전체 해석 경로 추적
$ dig +trace www.example.com
```

`dig +trace`는 Root 서버부터 최종 Authoritative 서버까지의 전체 DNS 해석 경로를 보여주어, 어느 단계에서 문제가 발생하는지 정확히 파악할 수 있습니다.

---

### 면접관: "DNS 캐싱과 TTL(Time To Live)에 대해 설명해주세요. 왜 중요합니까?"

**DNS 캐싱**은 한 번 조회한 DNS 결과를 일정 시간 동안 저장해두어 같은 질의를 반복하지 않도록 하는 메커니즘입니다.

캐싱이 일어나는 위치는 여러 곳입니다.

1. **클라이언트 PC** - OS 수준에서 DNS 캐시를 유지합니다.
2. **웹 브라우저** - 브라우저 자체 DNS 캐시가 있습니다.
3. **로컬 DNS 서버** - ISP나 사내 DNS 서버에서 캐싱합니다.

**TTL(Time To Live)**은 DNS 레코드가 캐시에 유지되는 시간(초 단위)입니다.

```
www.example.com.    3600    IN    A    93.184.216.34
                    ^^^^
                    TTL = 3600초 = 1시간
```

| TTL 값 | 의미 | 적합한 상황 |
|--------|------|-----------|
| 300 (5분) | 짧은 TTL | 서버 이전 예정, 빈번한 IP 변경 |
| 3600 (1시간) | 일반적 TTL | 대부분의 웹사이트 |
| 86400 (1일) | 긴 TTL | IP가 거의 바뀌지 않는 서비스 |

TTL이 중요한 이유는 다음과 같습니다.

- **짧은 TTL**: DNS 변경 사항이 빠르게 반영되지만, DNS 서버에 질의 부하가 증가합니다.
- **긴 TTL**: DNS 서버 부하가 줄지만, IP 변경 시 구 정보가 오래 캐시에 남아 접속 장애가 발생할 수 있습니다.

서버 마이그레이션을 계획할 때는 사전에 TTL을 짧게(300초 정도) 줄여놓고, 이전 완료 후 안정화되면 다시 원래 값으로 올리는 것이 일반적인 실무 관행입니다.

```
! Windows에서 DNS 캐시 확인 및 초기화
C:\> ipconfig /displaydns
C:\> ipconfig /flushdns
```

---

### 면접관: "마지막으로, DNS 관련해서 보안 측면에서 알아야 할 사항이 있을까요? CCNA 수준에서 말씀해주세요."

CCNA 수준에서 알아야 할 DNS 보안 이슈는 다음과 같습니다.

**1. DNS Spoofing(Poisoning)**
- 공격자가 가짜 DNS 응답을 주입하여 사용자를 악성 사이트로 유도합니다.
- 예: 은행 사이트 주소를 입력했지만, 공격자의 피싱 사이트 IP로 연결됩니다.
- 대응: DNSSEC(DNS Security Extensions)을 통한 응답 무결성 검증이 있습니다.

**2. DNS Amplification 공격 (DDoS)**
- 공격자가 출발지 IP를 피해자의 IP로 위조하여 DNS 서버에 대량 질의를 보냅니다.
- DNS 응답은 질의보다 크기가 크므로, 피해자에게 증폭된 트래픽이 집중됩니다.
- 대응: DNS 서버에서 재귀 질의를 신뢰할 수 있는 네트워크로 제한합니다.

**3. 불필요한 DNS 조회 비활성화 (Cisco 장비)**
```
! 잘못된 명령어 입력 시 DNS 조회 방지
Router(config)# no ip domain-lookup
```

이것은 보안보다는 운영 편의성 측면이지만, 네트워크 장비에서 불필요한 외부 DNS 트래픽을 줄이는 기본적인 설정으로 알려져 있습니다.
