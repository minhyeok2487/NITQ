# 04-02. DHCP 서버 구성

> CCNA 200-301 레벨 네트워크 엔지니어 면접 시나리오
> 주제: DHCP DORA 프로세스, 라우터 DHCP 서버 구성, 풀 설정, 제외 주소, DHCP Relay, 검증 명령어, 임대 시간, 트러블슈팅

---

### 면접관: "새 사무실에 PC 50대를 배치해야 하는데, 각 PC에 수동으로 IP를 설정하는 것은 비효율적입니다. 어떤 방법을 사용하시겠습니까?"

**DHCP(Dynamic Host Configuration Protocol)**를 사용하여 IP 주소를 자동으로 할당하겠습니다. DHCP를 사용하면 PC가 네트워크에 연결되는 즉시 IP 주소, 서브넷 마스크, 기본 게이트웨이, DNS 서버 주소 등의 네트워크 설정을 자동으로 받을 수 있습니다.

DHCP의 주요 장점은 다음과 같습니다.

- **관리 효율성**: 50대의 PC에 수동으로 IP를 설정하면 오류 가능성이 높고 시간이 많이 소요됩니다.
- **IP 충돌 방지**: DHCP 서버가 중앙에서 IP를 관리하므로 중복 할당을 방지합니다.
- **유연한 변경 관리**: DNS 서버 변경 등 네트워크 설정이 바뀌어도 DHCP 서버만 수정하면 됩니다.

Cisco 라우터 자체를 DHCP 서버로 구성하거나, 별도의 DHCP 서버(Windows Server, Linux 등)를 사용할 수 있습니다.

---

### 면접관: "DHCP에서 IP를 할당받는 DORA 프로세스를 단계별로 설명해주세요."

DHCP는 **DORA**라는 4단계 프로세스를 통해 클라이언트에게 IP 주소를 할당합니다.

| 단계 | 메시지 | 방향 | 설명 |
|------|--------|------|------|
| 1 | **D**iscover | 클라이언트 → 브로드캐스트 | IP를 요청하는 첫 번째 메시지 |
| 2 | **O**ffer | 서버 → 클라이언트 | 사용 가능한 IP를 제안 |
| 3 | **R**equest | 클라이언트 → 브로드캐스트 | 제안받은 IP를 공식 요청 |
| 4 | **A**ck | 서버 → 클라이언트 | IP 할당 확정 및 승인 |

상세 동작을 설명하면 다음과 같습니다.

1. **Discover**: 클라이언트는 아직 IP가 없으므로 출발지 0.0.0.0, 목적지 255.255.255.255로 브로드캐스트합니다. UDP 포트 68(클라이언트)에서 67(서버)로 전송합니다.

2. **Offer**: DHCP 서버가 사용 가능한 IP 주소, 서브넷 마스크, 임대 시간 등을 포함하여 응답합니다. 네트워크에 여러 DHCP 서버가 있으면 여러 Offer를 받을 수 있습니다.

3. **Request**: 클라이언트는 첫 번째로 받은 Offer를 선택하고, 다시 브로드캐스트로 요청합니다. 브로드캐스트인 이유는 선택되지 않은 다른 DHCP 서버에도 알리기 위해서입니다.

4. **Ack**: 서버가 최종 승인하며, 클라이언트는 이 시점부터 할당받은 IP를 사용합니다.

---

### 면접관: "Cisco 라우터를 DHCP 서버로 설정하는 방법을 보여주세요. 192.168.10.0/24 네트워크를 사용한다고 가정합니다."

#### 핵심 설정

```
! 1단계: DHCP에서 제외할 주소 범위 설정 (게이트웨이, 서버 등 고정 IP 장비)
Router(config)# ip dhcp excluded-address 192.168.10.1 192.168.10.10

! 2단계: DHCP 풀 생성 및 설정
Router(config)# ip dhcp pool OFFICE_LAN
Router(dhcp-config)# network 192.168.10.0 255.255.255.0
Router(dhcp-config)# default-router 192.168.10.1
Router(dhcp-config)# dns-server 8.8.8.8 8.8.4.4
Router(dhcp-config)# domain-name company.local
Router(dhcp-config)# lease 8
Router(dhcp-config)# exit
```

설정 내용을 정리하면 다음과 같습니다.

- **excluded-address**: 192.168.10.1 ~ 192.168.10.10은 DHCP 풀에서 제외합니다. 게이트웨이(라우터), 프린터, 서버 등 고정 IP가 필요한 장비에 사용합니다.
- **network**: 할당할 IP 대역을 지정합니다. 실제 할당 범위는 192.168.10.11 ~ 192.168.10.254가 됩니다.
- **default-router**: 클라이언트에게 전달할 기본 게이트웨이입니다.
- **dns-server**: DNS 서버 주소를 최대 8개까지 지정할 수 있습니다.
- **lease 8**: 임대 시간을 8일로 설정합니다. 기본값은 1일(24시간)입니다.

---

### 면접관: "DHCP 서버가 다른 네트워크(서브넷)에 있을 때는 어떻게 합니까? DHCP Discover는 브로드캐스트인데, 라우터를 넘어가지 못하지 않습니까?"

맞습니다. 브로드캐스트는 기본적으로 라우터를 통과하지 못합니다. 이 문제를 해결하기 위해 **DHCP Relay Agent** 기능, 즉 `ip helper-address` 명령을 사용합니다.

```
! DHCP 서버가 10.0.0.100에 있고, 클라이언트가 192.168.10.0/24 네트워크에 있는 경우
! 클라이언트 쪽 라우터 인터페이스에서 설정
Router(config)# interface GigabitEthernet0/0
Router(config-if)# ip address 192.168.10.1 255.255.255.0
Router(config-if)# ip helper-address 10.0.0.100
Router(config-if)# exit
```

동작 과정은 다음과 같습니다.

1. 클라이언트가 DHCP Discover를 브로드캐스트로 전송합니다.
2. 라우터의 Gi0/0 인터페이스에서 이 브로드캐스트를 수신합니다.
3. `ip helper-address`가 설정되어 있으므로, 라우터는 이 브로드캐스트를 **유니캐스트로 변환**하여 10.0.0.100(DHCP 서버)으로 전달합니다.
4. 이때 라우터는 패킷의 **giaddr(Gateway IP Address)** 필드에 Gi0/0의 IP(192.168.10.1)를 넣어, DHCP 서버가 어떤 서브넷의 요청인지 알 수 있게 합니다.
5. DHCP 서버는 giaddr를 기반으로 올바른 풀에서 IP를 할당합니다.

참고로 `ip helper-address`는 DHCP뿐만 아니라 TFTP, DNS, TACACS 등 총 8개의 UDP 서비스에 대해 브로드캐스트를 전달합니다.

---

### 면접관: "DHCP 설정 후 검증은 어떻게 합니까? 실제로 IP가 제대로 할당되고 있는지 확인하는 방법을 알려주세요."

#### 검증 명령어

```
! DHCP로 할당된 IP 바인딩 정보 확인
Router# show ip dhcp binding
Bindings from all pools not associated with VRF:
IP address       Client-ID/              Lease expiration        Type
                 Hardware address/
                 User name
192.168.10.11    0100.1a2b.3c4d.00       Feb 17 2026 09:30 AM   Automatic
192.168.10.12    0100.1a2b.3c4e.00       Feb 17 2026 09:35 AM   Automatic

! DHCP 풀 통계 확인
Router# show ip dhcp pool
Pool OFFICE_LAN :
 Utilization mark (high/low)    : 100 / 0
 Subnet size (first/next)       : 0 / 0
 Total addresses                : 254
 Leased addresses               : 2
 Pending event                  : none
 1 subnet is currently in the pool :
 Current index        IP address range                    Leased addresses
 192.168.10.13        192.168.10.1     - 192.168.10.254   2

! DHCP 충돌 정보 확인
Router# show ip dhcp conflict

! DHCP 서버 통계 확인
Router# show ip dhcp server statistics
```

`show ip dhcp binding`은 현재 어떤 MAC 주소에 어떤 IP가 할당되었는지, 임대 만료 시간은 언제인지를 보여주어 가장 자주 사용하는 명령어입니다.

---

### 면접관: "임대 시간(Lease Time)은 어떤 기준으로 설정합니까? 짧게 설정하면 어떤 문제가 있고, 길게 설정하면 어떤 문제가 있습니까?"

임대 시간 설정은 네트워크 환경에 따라 달라집니다.

| 환경 | 권장 임대 시간 | 이유 |
|------|--------------|------|
| 사무실 (고정 직원) | 8일 ~ 30일 | 장비 변동이 적어 긴 임대가 효율적 |
| 카페/공공 Wi-Fi | 1시간 ~ 4시간 | 사용자가 자주 바뀌므로 IP 회수 필요 |
| 회의실/게스트 네트워크 | 4시간 ~ 8시간 | 일시적 사용자에게 적합 |
| IoT 장비 | 7일 이상 | 항상 동일 IP 유지 권장 |

**짧은 임대 시간의 단점**: DHCP 서버와의 갱신(Renewal) 트래픽이 빈번하게 발생하여 네트워크에 부하를 줄 수 있습니다. 서버 장애 시 IP를 빠르게 잃을 수 있습니다.

**긴 임대 시간의 단점**: 사용하지 않는 장비가 IP를 계속 점유하여 IP 풀이 고갈될 수 있습니다. 네트워크 설정 변경이 클라이언트에 반영되기까지 시간이 오래 걸립니다.

참고로, 임대 시간의 50%가 지나면 클라이언트는 자동으로 **Renewal(갱신)**을 시도하고, 87.5%가 지나면 **Rebinding**을 시도합니다.

---

### 면접관: "DHCP 관련 트러블슈팅 경험을 말씀해주세요. 클라이언트가 IP를 받지 못하는 상황에서 어떻게 접근하시겠습니까?"

DHCP 트러블슈팅은 체계적으로 접근해야 합니다.

#### 단계별 진단

```
! 1단계: 클라이언트 쪽 확인 (Windows)
C:\> ipconfig /all          → 현재 IP 설정 확인 (169.254.x.x면 DHCP 실패)
C:\> ipconfig /release      → 기존 IP 해제
C:\> ipconfig /renew        → DHCP 재요청

! 2단계: 서버 쪽 확인
Router# show ip dhcp pool           → 풀에 남은 IP가 있는지 확인
Router# show ip dhcp conflict       → IP 충돌 여부 확인
Router# show ip dhcp binding        → 현재 할당 현황 확인

! 3단계: 네트워크 경로 확인
Router# show ip interface brief     → 인터페이스 상태 확인
Router# debug ip dhcp server events → DHCP 이벤트 실시간 모니터링
```

자주 발생하는 문제와 해결 방법을 정리하면 다음과 같습니다.

1. **APIPA 주소(169.254.x.x) 수신**: DHCP 서버와 통신 실패입니다. 물리적 연결, VLAN 설정, ip helper-address를 확인합니다.
2. **IP 풀 고갈**: `show ip dhcp pool`에서 Leased addresses가 Total addresses에 근접한 경우입니다. 임대 시간을 줄이거나 풀 범위를 확장합니다.
3. **Rogue DHCP 서버**: 인가되지 않은 DHCP 서버가 잘못된 IP를 배포하는 경우입니다. **DHCP Snooping**을 활성화하여 방지합니다.
4. **ip helper-address 누락**: 다른 서브넷의 클라이언트가 IP를 못 받는 가장 흔한 원인입니다.

```
! DHCP Snooping 기본 설정 (Rogue DHCP 방지)
Switch(config)# ip dhcp snooping
Switch(config)# ip dhcp snooping vlan 10
Switch(config)# interface GigabitEthernet0/1
Switch(config-if)# ip dhcp snooping trust    → DHCP 서버가 연결된 포트만 trust
```

---

### 면접관: "좋습니다. DHCP 서버를 라우터에 구성하는 것과 별도 서버에 구성하는 것의 차이를 간단히 비교해주세요."

| 구분 | 라우터 DHCP 서버 | 전용 DHCP 서버 |
|------|-----------------|---------------|
| 적합 환경 | 소규모 네트워크, 지사 | 중대형 네트워크, 본사 |
| 성능 | 라우터 CPU에 부하 | 전용 리소스 사용 |
| 관리 기능 | 기본적인 기능만 제공 | 고급 기능 (예약, 로그, 페일오버) |
| 비용 | 추가 비용 없음 | 서버 라이선스/하드웨어 필요 |
| 이중화 | 제한적 | DHCP Failover 지원 |

소규모 환경이나 지사 사무실에서는 라우터 DHCP가 충분하지만, 수백 대 이상의 장비를 관리하는 환경에서는 Windows Server나 ISC DHCP 같은 전용 서버를 사용하는 것이 적합합니다.
