# 09-04. OSPFv3

> 개요
IPv6 환경에서의 라우팅 프로토콜인 OSPFv3의 동작 원리, OSPFv2와의 차이점, 설정 방법, 그리고 트러블슈팅에 대한 면접 시나리오입니다.

---

### 면접관: "IPv6 네트워크에 OSPF를 구성해야 합니다. OSPFv3와 OSPFv2의 차이점을 설명하고, 왜 OSPFv3가 필요한지 알려주시겠습니까?"

네, OSPFv3는 IPv6를 지원하기 위해 설계된 OSPF 버전입니다. OSPFv2는 IPv4 전용이므로 IPv6 네트워크에서는 OSPFv3를 사용해야 합니다.

**OSPFv2 vs OSPFv3 비교:**

| 항목 | OSPFv2 | OSPFv3 |
|------|--------|--------|
| 지원 프로토콜 | IPv4만 | IPv6 (+ Address Family로 IPv4도 가능) |
| 네이버 수립 | IPv4 주소 사용 | Link-Local 주소 사용 |
| 멀티캐스트 주소 | 224.0.0.5, 224.0.0.6 | FF02::5, FF02::6 |
| 인증 | OSPF 자체 인증 | IPsec 사용 (OSPFv3 자체 인증 없음) |
| Router-ID | IPv4 형식 (32비트) | IPv4 형식 (32비트, 수동 설정 권장) |
| 설정 방식 | network 명령어 (라우터 모드) | 인터페이스에서 직접 활성화 |
| LSA 변경 | - | 새로운 LSA 타입 추가 (Link LSA, Intra-Area Prefix LSA) |
| 인스턴스 | 프로세스 ID | 인스턴스 ID (인터페이스별 다중 인스턴스 가능) |

가장 핵심적인 차이점은 다음 세 가지입니다:

1. **Link-Local 주소로 네이버 수립**: OSPFv3는 네이버 간 통신에 Link-Local 주소를 사용합니다
2. **인터페이스 기반 설정**: `network` 명령어 대신 인터페이스에서 직접 OSPF를 활성화합니다
3. **Router-ID가 여전히 IPv4 형식**: IPv6 환경에서도 32비트 IPv4 형식의 Router-ID를 사용하므로, IPv4 주소가 없으면 수동으로 설정해야 합니다

---

### 면접관: "OSPFv3를 실제로 설정하는 방법을 보여주시겠습니까? 기본적인 구성 예시를 들어주세요."

네, OSPFv3의 기본 설정을 보여드리겠습니다.

**네트워크 토폴로지:**
```
R1 (Gi0/0) ---- (Gi0/0) R2 (Gi0/1) ---- (Gi0/0) R3
  2001:DB8:12::/64      2001:DB8:23::/64
```

**R1 설정:**

```
R1(config)# ipv6 unicast-routing
R1(config)# ipv6 router ospf 1
R1(config-rtr)# router-id 1.1.1.1
R1(config-rtr)# exit
R1(config)# interface GigabitEthernet0/0
R1(config-if)# ipv6 address 2001:DB8:12::1/64
R1(config-if)# ipv6 ospf 1 area 0
R1(config-if)# no shutdown
```

**R2 설정:**

```
R2(config)# ipv6 unicast-routing
R2(config)# ipv6 router ospf 1
R2(config-rtr)# router-id 2.2.2.2
R2(config-rtr)# exit
R2(config)# interface GigabitEthernet0/0
R2(config-if)# ipv6 address 2001:DB8:12::2/64
R2(config-if)# ipv6 ospf 1 area 0
R2(config-if)# no shutdown
R2(config)# interface GigabitEthernet0/1
R2(config-if)# ipv6 address 2001:DB8:23::1/64
R2(config-if)# ipv6 ospf 1 area 0
R2(config-if)# no shutdown
```

**R3 설정:**

```
R3(config)# ipv6 unicast-routing
R3(config)# ipv6 router ospf 1
R3(config-rtr)# router-id 3.3.3.3
R3(config-rtr)# exit
R3(config)# interface GigabitEthernet0/0
R3(config-if)# ipv6 address 2001:DB8:23::2/64
R3(config-if)# ipv6 ospf 1 area 0
R3(config-if)# no shutdown
```

주요 포인트:
- `ipv6 unicast-routing`은 IPv6 라우팅을 위한 필수 전역 명령어입니다
- `ipv6 router ospf 1`에서 1은 프로세스 ID입니다
- `router-id`는 반드시 IPv4 형식으로 설정해야 합니다. IPv4 주소가 없는 장비에서는 수동 설정이 필수입니다
- `ipv6 ospf 1 area 0`은 인터페이스에서 직접 OSPFv3를 활성화하는 명령어입니다

---

### 면접관: "Router-ID를 설정하지 않으면 어떻게 되나요? OSPFv2처럼 자동으로 선택됩니까?"

좋은 질문입니다. OSPFv3에서도 Router-ID 자동 선택 로직은 OSPFv2와 동일합니다.

**Router-ID 선택 우선순위:**

```
1순위: 수동 설정된 Router-ID (router-id 명령어)
2순위: Loopback 인터페이스 중 가장 높은 IPv4 주소
3순위: 물리 인터페이스 중 가장 높은 IPv4 주소
```

**문제점:**

IPv6 전용 환경에서는 장비에 IPv4 주소가 없을 수 있습니다. 이 경우 2순위와 3순위 선택이 불가능하므로, OSPFv3 프로세스가 시작되지 않고 다음과 같은 에러가 발생합니다:

```
%OSPFv3-4-NORTRID: OSPFv3 process 1 could not pick a router-id,
please configure manually
```

따라서 IPv6 전용 환경에서는 반드시 Router-ID를 수동으로 설정해야 합니다:

```
R1(config)# ipv6 router ospf 1
R1(config-rtr)# router-id 1.1.1.1
```

실무에서의 모범 사례는 IPv4와 IPv6를 모두 사용하더라도 Router-ID를 항상 명시적으로 설정하는 것입니다. 이렇게 하면 인터페이스 상태 변경이 Router-ID에 영향을 주지 않아 안정적입니다.

---

### 면접관: "OSPFv3가 Link-Local 주소를 사용하여 네이버를 수립한다고 하셨는데, 이것이 실무에서 어떤 의미를 갖나요?"

OSPFv3가 Link-Local 주소를 사용하는 것은 매우 중요한 특징이며, 여러 실무적 의미가 있습니다.

**Link-Local 주소 사용의 의미:**

1. **라우팅 테이블의 Next-Hop이 Link-Local 주소**: OSPFv3로 학습한 경로의 next-hop이 네이버의 Link-Local 주소로 표시됩니다

```
R1# show ipv6 route ospf
O   2001:DB8:23::/64 [110/2]
     via FE80::2, GigabitEthernet0/0
```

2. **글로벌 주소 변경에 영향 없음**: 인터페이스의 Global Unicast 주소가 변경되어도 네이버 관계가 유지됩니다. Link-Local 주소는 인터페이스가 유지되는 한 변경되지 않기 때문입니다.

3. **보안**: Link-Local 주소는 해당 링크 밖으로 나가지 않으므로, 외부에서 OSPF 네이버를 직접 공격하기 어렵습니다.

**네이버 확인 명령어:**

```
R1# show ipv6 ospf neighbor

OSPFv3 Router with ID (1.1.1.1) (Process ID 1)

Neighbor ID  Pri  State      Dead Time  Interface ID  Interface
2.2.2.2       1  FULL/BDR   00:00:35   4             Gi0/0
```

```
R1# show ipv6 ospf interface GigabitEthernet0/0

GigabitEthernet0/0 is up, line protocol is up
  Link Local Address FE80::211:22FF:FE33:4455, Interface ID 3
  Area 0, Process ID 1, Instance ID 0, Router ID 1.1.1.1
  Network Type BROADCAST, Cost: 1
  Transmit Delay is 1 sec, State DR, Priority 1
  Designated Router (ID) 1.1.1.1
  Backup Designated Router (ID) 2.2.2.2
  Timer intervals configured, Hello 10, Dead 40, Wait 40, Retransmit 5
```

---

### 면접관: "OSPFv3에서 Address Family라는 개념이 있다고 들었는데, 이것은 무엇인가요?"

Address Family(AF)는 OSPFv3의 확장 기능으로, 하나의 OSPFv3 프로세스에서 IPv4와 IPv6를 동시에 지원할 수 있는 기능입니다.

**전통적인 방식:**
```
IPv4 → OSPFv2 사용
IPv6 → OSPFv3 사용
= 두 개의 별도 라우팅 프로세스 운영 필요
```

**Address Family 방식:**
```
IPv4 + IPv6 → OSPFv3 하나로 통합 관리
```

설정 예시:

```
! Address Family 방식 (OSPFv3 with AF)
R1(config)# router ospfv3 1
R1(config-router)# router-id 1.1.1.1
R1(config-router)# address-family ipv4 unicast
R1(config-router-af)# exit-address-family
R1(config-router)# address-family ipv6 unicast
R1(config-router-af)# exit-address-family
R1(config-router)# exit

R1(config)# interface GigabitEthernet0/0
R1(config-if)# ip address 192.168.12.1 255.255.255.0
R1(config-if)# ipv6 address 2001:DB8:12::1/64
R1(config-if)# ospfv3 1 ipv4 area 0
R1(config-if)# ospfv3 1 ipv6 area 0
```

CCNA 수준에서는 Address Family의 개념을 이해하고, 전통적인 OSPFv3 설정 방식을 잘 알고 있으면 충분합니다. Address Family 방식은 관리의 편의성을 높이지만, 전통 방식도 여전히 널리 사용됩니다.

---

### 면접관: "OSPFv3가 정상 동작하지 않을 때, 어떤 순서로 트러블슈팅하시겠습니까?"

OSPFv3 트러블슈팅은 체계적인 접근이 필요합니다. 단계별로 설명드리겠습니다.

**1단계: 기본 전제 조건 확인**

```
! IPv6 라우팅이 활성화되어 있는지 확인
R1# show running-config | include ipv6 unicast-routing

! 인터페이스 상태 확인
R1# show ipv6 interface brief

! Link-Local 주소가 할당되어 있는지 확인
R1# show ipv6 interface GigabitEthernet0/0
```

**2단계: OSPFv3 프로세스 상태 확인**

```
! OSPFv3 프로세스 확인
R1# show ipv6 ospf

! Router-ID가 설정되어 있는지 확인
! Area가 올바른지 확인
```

**3단계: 네이버 관계 확인**

```
R1# show ipv6 ospf neighbor
```

네이버가 보이지 않으면 확인할 사항:
- 같은 서브넷에 있는지
- Hello/Dead 타이머가 일치하는지
- Area ID가 일치하는지
- 네트워크 타입이 일치하는지
- 인터페이스에서 OSPFv3가 활성화되어 있는지
- ACL이 ICMPv6를 차단하고 있지 않은지

**4단계: 인터페이스별 OSPF 상태 확인**

```
R1# show ipv6 ospf interface
R1# show ipv6 ospf interface brief
```

**5단계: 라우팅 테이블 확인**

```
R1# show ipv6 route ospf
```

**6단계: 실시간 디버깅 (주의해서 사용)**

```
R1# debug ipv6 ospf adjacency
R1# debug ipv6 ospf hello
```

**자주 발생하는 OSPFv3 문제와 해결:**

| 문제 | 원인 | 해결 |
|------|------|------|
| 네이버 안 맺힘 | Router-ID 미설정 | router-id 명령어로 설정 |
| 네이버 안 맺힘 | ipv6 unicast-routing 누락 | 전역 모드에서 활성화 |
| 네이버 안 맺힘 | Area 불일치 | 양측 Area ID 확인 |
| 네이버 안 맺힘 | Hello/Dead 타이머 불일치 | 양측 타이머 통일 |
| 경로 안 보임 | 인터페이스에서 OSPF 미활성화 | ipv6 ospf 명령어 확인 |
| EXSTART 상태 고착 | MTU 불일치 | 양측 MTU 확인 및 통일 |

트러블슈팅에서 가장 중요한 것은 기본부터 확인하는 것입니다. `ipv6 unicast-routing` 누락이나 Router-ID 미설정 같은 단순한 문제가 의외로 많이 발생합니다.

---

### 면접관: "OSPFv3와 OSPFv2를 동시에 운영하는 듀얼 스택 환경에서 주의할 점은 무엇인가요?"

듀얼 스택 환경에서 OSPFv2와 OSPFv3를 동시에 운영할 때 주의할 점을 정리하겠습니다.

**주의사항:**

1. **별도의 프로세스**: OSPFv2와 OSPFv3는 완전히 독립적인 프로세스로 동작합니다. 각각의 LSDB, SPF 계산, 라우팅 테이블을 별도로 유지합니다.

2. **Router-ID 충돌 방지**: 두 프로세스에서 같은 Router-ID를 사용해도 문제는 없지만, 관리 편의를 위해 통일하는 것이 좋습니다.

3. **설정 방식의 차이**: OSPFv2는 `network` 명령어, OSPFv3는 인터페이스에서 직접 활성화합니다. 혼동하지 않도록 주의합니다.

```
! OSPFv2 (IPv4)
R1(config)# router ospf 1
R1(config-router)# router-id 1.1.1.1
R1(config-router)# network 192.168.1.0 0.0.0.255 area 0

! OSPFv3 (IPv6)
R1(config)# ipv6 router ospf 1
R1(config-rtr)# router-id 1.1.1.1
R1(config)# interface GigabitEthernet0/0
R1(config-if)# ipv6 ospf 1 area 0
```

4. **리소스 관리**: 두 개의 OSPF 프로세스를 운영하면 CPU와 메모리 사용량이 증가합니다. 대규모 네트워크에서는 이를 고려한 장비 선정이 필요합니다.

5. **모니터링**: 각 프로세스를 별도로 모니터링해야 합니다.

```
! IPv4 OSPF 확인
R1# show ip ospf neighbor
R1# show ip route ospf

! IPv6 OSPF 확인
R1# show ipv6 ospf neighbor
R1# show ipv6 route ospf
```

듀얼 스택은 IPv4에서 IPv6로의 전환 과정에서 가장 일반적인 운영 방식이며, 두 프로토콜 스택을 모두 이해하고 관리할 수 있어야 합니다.
