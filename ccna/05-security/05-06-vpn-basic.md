# 05-06. VPN 기본 개념 (IPSec/SSL)

> CCNA 200-301 보안 면접 시나리오 - VPN 유형과 IPSec/SSL 기본 원리

---

### 면접관: "VPN이 무엇이고, 왜 필요한지 설명해 주세요."

VPN은 Virtual Private Network의 약자로, 공용 네트워크(인터넷)를 통해 **마치 전용선처럼 안전한 사설 통신 채널**을 만드는 기술입니다.

VPN이 필요한 이유는 다음과 같습니다.

1. **보안**: 인터넷을 통한 통신을 암호화하여 도청을 방지합니다
2. **비용 절감**: 고가의 전용선 대신 인터넷을 활용하여 비용을 절약합니다
3. **원격 접속**: 재택근무자나 출장 직원이 회사 내부 네트워크에 안전하게 접근할 수 있습니다
4. **지사 연결**: 본사와 지사 간의 안전한 통신을 제공합니다

VPN이 제공하는 핵심 보안 서비스는 세 가지입니다.

| 보안 서비스 | 설명 | 역할 |
|------------|------|------|
| **기밀성 (Confidentiality)** | 데이터 암호화 | 제3자가 내용을 볼 수 없음 |
| **무결성 (Integrity)** | 데이터 변조 탐지 | 전송 중 데이터가 수정되지 않았음을 보장 |
| **인증 (Authentication)** | 상대방 신원 확인 | 통신 상대가 진짜인지 검증 |

```
VPN 없이:
[본사] ──── 인터넷 (평문 전송, 도청 가능) ──── [지사]

VPN 사용:
[본사] ════ 인터넷 (암호화 터널) ════ [지사]
         ↑ 외부에서는 내용을 볼 수 없음
```

---

### 면접관: "Site-to-Site VPN과 Remote Access VPN의 차이를 설명해 주세요."

VPN은 사용 형태에 따라 크게 두 가지로 분류됩니다.

**Site-to-Site VPN (사이트 간 VPN)**

두 고정된 네트워크 사이에 영구적인 VPN 터널을 구성합니다. 양쪽에 VPN 게이트웨이 장비(라우터, 방화벽)가 있어야 합니다.

```
[본사 네트워크]                          [지사 네트워크]
 10.1.0.0/16                            10.2.0.0/16
      │                                       │
 [VPN Gateway] ═══ IPSec 터널 ═══ [VPN Gateway]
      │              인터넷              │
```

**Remote Access VPN (원격 접속 VPN)**

개별 사용자가 노트북이나 스마트폰에서 VPN 클라이언트 소프트웨어를 통해 회사 네트워크에 접속합니다.

```
[재택근무자 PC] ──── VPN Client
        │
     인터넷              [회사 네트워크]
        │                      │
   ═══ SSL/IPSec 터널 ═══ [VPN Gateway]
```

| 구분 | Site-to-Site | Remote Access |
|------|-------------|---------------|
| 연결 형태 | 네트워크 대 네트워크 | 개별 사용자 대 네트워크 |
| 연결 지속성 | 항상 연결 (상시) | 필요할 때 연결 |
| 클라이언트 SW | 불필요 (게이트웨이가 처리) | 필요 (또는 웹 브라우저) |
| 주요 프로토콜 | IPSec | SSL/TLS 또는 IPSec |
| 사용 사례 | 본사-지사 연결 | 재택근무, 출장, 모바일 |
| 사용자 인식 | 사용자가 VPN을 인식하지 못함 | 사용자가 직접 연결 |

---

### 면접관: "IPSec VPN의 기본 구성 요소에 대해 설명해 주세요."

IPSec(Internet Protocol Security)은 네트워크 계층(Layer 3)에서 동작하는 VPN 프로토콜 모음(framework)입니다. 하나의 프로토콜이 아니라 여러 프로토콜의 조합입니다.

IPSec의 핵심 구성 요소는 다음과 같습니다.

**1. IKE (Internet Key Exchange) - 키 교환**

VPN 터널을 설정하기 위한 협상 프로토콜입니다. 두 단계로 진행됩니다.

| 단계 | IKE Phase 1 | IKE Phase 2 |
|------|-------------|-------------|
| 목적 | 안전한 관리 채널(ISAKMP SA) 생성 | 실제 데이터 전송용 터널(IPSec SA) 생성 |
| 협상 내용 | 암호화/해시/인증/DH 그룹 | 암호화/해시/프로토콜(ESP/AH) |
| 모드 | Main Mode 또는 Aggressive Mode | Quick Mode |
| 결과 | 양방향 1개의 SA | 단방향 2개의 SA (송신용, 수신용) |

```
Phase 1: "서로 믿을 수 있는 안전한 통로를 먼저 만들자"
    ↓
Phase 2: "이 안전한 통로를 통해 실제 데이터 터널을 협상하자"
    ↓
데이터 전송: "협상된 보안 정책으로 데이터를 암호화하여 전송"
```

**2. ESP (Encapsulating Security Payload)**

데이터의 기밀성(암호화), 무결성, 인증을 모두 제공합니다. 가장 널리 사용되는 프로토콜입니다. IP 프로토콜 번호 50을 사용합니다.

**3. AH (Authentication Header)**

데이터의 무결성과 인증만 제공하고, 암호화는 제공하지 않습니다. IP 프로토콜 번호 51을 사용합니다.

| 구분 | ESP | AH |
|------|-----|-----|
| 기밀성 (암호화) | O | X |
| 무결성 | O | O |
| 인증 | O | O |
| IP 헤더 보호 | X (원본 IP 헤더) | O |
| 실무 사용 빈도 | 매우 높음 | 낮음 |
| 프로토콜 번호 | 50 | 51 |

실무에서는 대부분 **ESP**를 사용합니다. 암호화가 제공되지 않는 AH만으로는 기밀성을 보장할 수 없기 때문입니다.

---

### 면접관: "Tunnel Mode와 Transport Mode의 차이를 설명해 주세요."

IPSec에는 두 가지 동작 모드가 있으며, 원본 IP 패킷을 어떻게 처리하는지에 차이가 있습니다.

**Tunnel Mode (기본 모드)**

원본 IP 패킷 전체를 암호화하고, 새로운 IP 헤더를 추가합니다.

```
원본 패킷:
[원본 IP 헤더 | 데이터]

Tunnel Mode 적용 후:
[새 IP 헤더 | ESP 헤더 | 원본 IP 헤더 | 데이터 | ESP 트레일러]
                       └──── 암호화 영역 ────┘
```

**Transport Mode**

원본 IP 헤더는 그대로 유지하고, 데이터 부분만 암호화합니다.

```
원본 패킷:
[원본 IP 헤더 | 데이터]

Transport Mode 적용 후:
[원본 IP 헤더 | ESP 헤더 | 데이터 | ESP 트레일러]
                        └ 암호화 ┘
```

| 구분 | Tunnel Mode | Transport Mode |
|------|-------------|----------------|
| IP 헤더 | 새 IP 헤더 추가 | 원본 IP 헤더 유지 |
| 암호화 범위 | 원본 패킷 전체 | 데이터 페이로드만 |
| 원본 IP 노출 | 숨겨짐 (새 헤더만 보임) | 노출됨 |
| 오버헤드 | 상대적으로 큼 | 상대적으로 작음 |
| 주요 사용처 | Site-to-Site VPN | 호스트 간 직접 통신 (GRE 터널 내부) |
| 기본값 여부 | IPSec 기본 모드 | 명시적 설정 필요 |

**Site-to-Site VPN에서는 Tunnel Mode**를 사용합니다. 내부 네트워크의 실제 IP 주소가 외부에 노출되지 않아야 하기 때문입니다. VPN 게이트웨이의 공인 IP만 새 헤더에 표시됩니다.

---

### 면접관: "SSL VPN은 IPSec VPN과 어떻게 다르고, 어떤 장점이 있나요?"

SSL VPN은 SSL/TLS 프로토콜을 사용하는 VPN으로, 주로 **Remote Access VPN**에 사용됩니다.

IPSec VPN과의 핵심 차이점은 다음과 같습니다.

| 구분 | IPSec VPN | SSL VPN |
|------|-----------|---------|
| 동작 계층 | Layer 3 (네트워크) | Layer 4-7 (전송/응용) |
| 클라이언트 SW | 전용 클라이언트 필수 | 웹 브라우저만으로 가능 (Clientless) |
| 방화벽 통과 | UDP 500/4500 허용 필요 | HTTPS(443) 사용 - 대부분 허용됨 |
| 접근 제어 | 네트워크 레벨 | 애플리케이션 레벨 가능 |
| 설정 복잡도 | 상대적으로 높음 | 상대적으로 낮음 |
| 전체 네트워크 접근 | 기본 제공 | Full Tunnel 모드 시 가능 |

SSL VPN은 두 가지 모드로 동작합니다.

**1. Clientless SSL VPN (웹 기반)**
- 웹 브라우저에서 HTTPS로 VPN 포털에 접속
- 별도 소프트웨어 설치 불필요
- 웹 기반 애플리케이션에 접근 가능
- 지원 범위가 제한적 (모든 프로토콜을 지원하지 않음)

**2. Full Tunnel SSL VPN (클라이언트 기반)**
- AnyConnect 같은 경량 클라이언트 사용
- 모든 네트워크 트래픽을 VPN 터널로 전송
- IPSec VPN과 유사한 수준의 네트워크 접근 제공

SSL VPN의 가장 큰 장점은 **편의성**입니다. 호텔, 카페 등 공공 Wi-Fi 환경에서도 웹 브라우저만 있으면 회사 네트워크에 접속할 수 있습니다. 방화벽에서 HTTPS(443)는 거의 항상 허용되므로 연결 문제도 적습니다.

---

### 면접관: "VPN에서 사용하는 암호화와 무결성 알고리즘에 대해 기본적인 것들을 알려주세요."

VPN의 보안은 여러 알고리즘의 조합으로 구성됩니다. CCNA 수준에서 알아야 할 기본 알고리즘을 정리하겠습니다.

**암호화 알고리즘 (Encryption) - 기밀성 제공**

| 알고리즘 | 키 길이 | 특징 |
|----------|---------|------|
| DES | 56비트 | 구식, 보안 취약 (사용 금지) |
| 3DES | 168비트 | DES 3회 적용, 느림 |
| AES-128 | 128비트 | 현재 표준, 빠르고 안전 |
| AES-256 | 256비트 | 가장 강력, 고보안 환경 |

**해시 알고리즘 (Hashing) - 무결성 제공**

| 알고리즘 | 해시 길이 | 특징 |
|----------|----------|------|
| MD5 | 128비트 | 구식, 충돌 취약점 발견 |
| SHA-1 | 160비트 | MD5보다 안전하지만 역시 구식 |
| SHA-256 | 256비트 | 현재 권장 |

**키 교환 알고리즘 - 안전한 키 공유**

DH(Diffie-Hellman) 그룹을 사용합니다.

| DH 그룹 | 키 길이 | 보안 수준 |
|---------|---------|----------|
| Group 2 | 1024비트 | 취약 (비권장) |
| Group 5 | 1536비트 | 최소 권장 |
| Group 14 | 2048비트 | 권장 |
| Group 19/20 | ECDH | 최신 (타원곡선) |

**인증 방법**

- **Pre-Shared Key (PSK)**: 양쪽에 동일한 비밀키를 미리 설정. 간단하지만 확장성 낮음
- **Digital Certificate (인증서)**: PKI 기반 인증. 확장성 높음, 관리 복잡

실무에서 현재 권장되는 조합은 **AES-256 + SHA-256 + DH Group 14 이상**입니다. DES, 3DES, MD5는 보안 취약점이 알려져 있어 사용을 피해야 합니다.

---

### 면접관: "마지막으로, 실무에서 VPN 유형을 선택할 때 어떤 기준으로 결정하나요?"

VPN 유형 선택은 요구사항에 따라 달라집니다. 주요 판단 기준을 정리하겠습니다.

| 요구사항 | 권장 VPN 유형 | 이유 |
|----------|-------------|------|
| 본사-지사 상시 연결 | IPSec Site-to-Site | 안정적인 상시 터널, 양쪽 게이트웨이 존재 |
| 재택근무자 접속 | SSL VPN (AnyConnect) | 클라이언트 설치 간편, 방화벽 통과 용이 |
| 협력업체 제한적 접근 | Clientless SSL VPN | 소프트웨어 설치 불가, 웹 앱만 접근 |
| 고성능/대용량 | IPSec Site-to-Site | 하드웨어 가속 지원, 높은 처리량 |
| 모바일 사용자 | SSL VPN | 다양한 네트워크 환경에서 접속 가능 |

실무에서 흔히 보는 구성은 다음과 같습니다.

```
[본사]
  │
  ├── IPSec Site-to-Site ──── [지사 A]
  ├── IPSec Site-to-Site ──── [지사 B]
  │
  ├── SSL VPN (AnyConnect) ── [재택근무자]
  └── Clientless SSL VPN ──── [협력업체]
```

추가 고려사항으로는 다음이 있습니다.

- **비용**: SSL VPN은 사용자 라이선스 비용이 발생할 수 있습니다
- **성능**: IPSec은 하드웨어 가속이 잘 지원되어 대용량 처리에 유리합니다
- **호환성**: 다양한 벤더 장비 간 VPN은 IPSec이 표준 호환성이 높습니다
- **보안 정책**: 회사 정책에 따라 특정 VPN 유형이 요구될 수 있습니다
- **Split Tunneling**: VPN 트래픽만 터널로 보낼지, 모든 트래픽을 터널로 보낼지 결정해야 합니다. 보안 관점에서는 Full Tunnel이 안전하지만, 인터넷 성능이 저하될 수 있습니다

정리하면, VPN은 현대 네트워크 보안의 필수 요소이며, IPSec과 SSL이라는 두 가지 큰 축을 이해하고 상황에 맞게 선택하는 것이 중요합니다. CCNA 수준에서는 각 VPN 유형의 특징과 차이점, 그리고 기본적인 암호화 개념을 이해하는 것이 핵심입니다.
