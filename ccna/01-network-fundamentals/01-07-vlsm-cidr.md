# 01-07. VLSM과 CIDR

> CCNA 200-301 수준의 네트워크 엔지니어 면접 시나리오입니다.
> VLSM 개념, CIDR 표기법, 슈퍼넷팅, 효율적 IP 할당, 클래스풀과의 차이, 경로 요약 등을 다룹니다.

---

### 면접관: "VLSM(Variable Length Subnet Mask)이란 무엇이고, 왜 필요한가요? 기존 클래스풀 서브넷팅과 비교해서 설명해 주세요."

VLSM은 하나의 네트워크 내에서 서로 다른 길이의 서브넷 마스크를 사용할 수 있는 기술입니다. 이를 통해 각 서브넷의 크기를 실제 필요에 맞게 유연하게 조절할 수 있습니다.

**클래스풀(Classful) 서브넷팅의 문제점:**

클래스풀 서브넷팅에서는 하나의 네트워크를 나눌 때 모든 서브넷이 **동일한 서브넷 마스크**를 사용해야 했습니다.

```
예시: 192.168.1.0/24를 /26으로 동일하게 서브넷팅

서브넷 1: 192.168.1.0/26   (호스트 62개) ← 영업부 (45명)
서브넷 2: 192.168.1.64/26  (호스트 62개) ← 개발부 (10명) → 52개 낭비!
서브넷 3: 192.168.1.128/26 (호스트 62개) ← WAN 링크 (2개) → 60개 낭비!
서브넷 4: 192.168.1.192/26 (호스트 62개) ← 미사용

총 낭비: 17 + 52 + 60 + 62 = 191개 IP 주소 낭비!
```

**VLSM으로 해결:**

VLSM을 사용하면 각 서브넷에 필요한 만큼만 IP를 할당할 수 있습니다.

```
서브넷 1: 192.168.1.0/26   (호스트 62개) ← 영업부 (45명) → 17개 여유
서브넷 2: 192.168.1.64/28  (호스트 14개) ← 개발부 (10명) → 4개 여유
서브넷 3: 192.168.1.80/30  (호스트 2개)  ← WAN 링크 (2개) → 0개 낭비
나머지: 192.168.1.82 ~ 192.168.1.255 → 향후 사용 가능!

총 여유: 대부분의 IP를 향후 확장에 활용 가능
```

| 비교 항목 | 클래스풀 서브넷팅 | VLSM |
|-----------|-----------------|------|
| 서브넷 마스크 | 전체 동일 | 서브넷마다 다를 수 있음 |
| IP 효율성 | 낮음 | 높음 |
| 유연성 | 낮음 | 높음 |
| 지원 프로토콜 | RIPv1, IGRP | RIPv2, OSPF, EIGRP, BGP |
| 서브넷 크기 | 모두 동일 | 필요에 따라 조절 |

---

### 면접관: "CIDR(Classless Inter-Domain Routing)에 대해 설명해 주세요. CIDR 표기법은 무엇을 의미하나요?"

CIDR(사이더)는 기존의 클래스 기반 주소 체계를 벗어나, 서브넷 마스크의 길이를 자유롭게 지정할 수 있는 IP 주소 지정 방식입니다. 1993년 RFC 4632에 정의되었습니다.

**CIDR 표기법:**

CIDR 표기법은 IP 주소 뒤에 슬래시(/)와 프리픽스 길이(Prefix Length)를 표기합니다.

```
192.168.1.0/24

/24 = 서브넷 마스크의 1인 비트 수 = 24개
    = 255.255.255.0

다양한 CIDR 표기 예시:
10.0.0.0/8       = 255.0.0.0
172.16.0.0/12    = 255.240.0.0
192.168.1.0/24   = 255.255.255.0
192.168.1.0/26   = 255.255.255.192
192.168.1.0/30   = 255.255.255.252
```

**CIDR의 핵심 장점:**

1. **클래스 경계 제거**: Class A, B, C와 관계없이 원하는 크기로 네트워크를 정의할 수 있습니다.
2. **경로 요약(Route Summarization/Aggregation)**: 여러 네트워크를 하나의 경로로 요약하여 라우팅 테이블 크기를 줄입니다.
3. **IP 주소 효율적 할당**: 필요한 만큼만 주소를 할당할 수 있습니다.

```
! CIDR을 활용한 라우팅 설정
Router(config)# ip route 192.168.0.0 255.255.0.0 10.0.0.1
! /16으로 요약하여 192.168.0.0 ~ 192.168.255.255 전체를 하나의 경로로 처리

Router# show ip route
S     192.168.0.0/16 [1/0] via 10.0.0.1
```

---

### 면접관: "슈퍼넷팅(Supernetting)이란 무엇인가요? 경로 요약(Route Summarization)과 어떤 관계가 있나요?"

**슈퍼넷팅**은 여러 개의 작은 네트워크를 하나의 큰 네트워크로 합치는 것입니다. 서브넷팅의 반대 개념이라고 볼 수 있습니다.

```
서브넷팅:  하나의 큰 네트워크 → 여러 개의 작은 네트워크로 분할
슈퍼넷팅:  여러 개의 작은 네트워크 → 하나의 큰 네트워크로 합침
```

**경로 요약(Route Summarization):**

경로 요약은 슈퍼넷팅을 라우팅에 적용한 것으로, 여러 개의 세부 경로를 하나의 요약 경로로 합치는 기술입니다.

**예시: 4개의 /24 네트워크를 하나의 /22로 요약**

```
개별 네트워크:
192.168.0.0/24   → 11000000.10101000.00000000.xxxxxxxx
192.168.1.0/24   → 11000000.10101000.00000001.xxxxxxxx
192.168.2.0/24   → 11000000.10101000.00000010.xxxxxxxx
192.168.3.0/24   → 11000000.10101000.00000011.xxxxxxxx
                                      ^^^^^^
                           공통 부분: 000000 (앞 6비트 동일)

요약 경로: 192.168.0.0/22
(프리픽스 22비트가 공통)
```

**경로 요약의 장점:**

| 장점 | 설명 |
|------|------|
| 라우팅 테이블 축소 | 4개의 경로 → 1개의 경로 |
| 라우터 메모리 절약 | 더 적은 경로 항목 저장 |
| CPU 부하 감소 | 라우팅 연산 줄어듦 |
| 업데이트 안정성 | 하위 네트워크 변경이 상위로 전파되지 않음 |

#### 경로 요약 설정 예시

```
! 요약 전: 4개의 개별 경로
Router# show ip route
S     192.168.0.0/24 [1/0] via 10.0.0.1
S     192.168.1.0/24 [1/0] via 10.0.0.1
S     192.168.2.0/24 [1/0] via 10.0.0.1
S     192.168.3.0/24 [1/0] via 10.0.0.1

! 요약 후: 1개의 요약 경로
Router(config)# ip route 192.168.0.0 255.255.252.0 10.0.0.1

Router# show ip route
S     192.168.0.0/22 [1/0] via 10.0.0.1
```

---

### 면접관: "실무에서 VLSM을 적용하여 IP 주소를 할당하는 시나리오를 하나 풀어 보세요."

다음과 같은 회사 네트워크에 IP를 할당해 보겠습니다.

**시나리오:**
- 할당 가능한 네트워크: 172.16.10.0/24
- 본사 영업팀: 100명
- 본사 개발팀: 50명
- 지사 관리팀: 25명
- 서버 팜: 10대
- WAN 링크 3개: 각 2개 IP 필요

#### VLSM 할당 절차

**1단계: 필요 호스트 수 기준으로 정렬 (큰 것부터)**

| 부서 | 필요 호스트 | 필요 서브넷 | 호스트 비트 |
|------|-----------|-----------|-----------|
| 영업팀 | 100 | /25 (126개) | 7비트 |
| 개발팀 | 50 | /26 (62개) | 6비트 |
| 관리팀 | 25 | /27 (30개) | 5비트 |
| 서버 팜 | 10 | /28 (14개) | 4비트 |
| WAN 1 | 2 | /30 (2개) | 2비트 |
| WAN 2 | 2 | /30 (2개) | 2비트 |
| WAN 3 | 2 | /30 (2개) | 2비트 |

**2단계: 큰 서브넷부터 순서대로 할당**

| 용도 | 서브넷 | 네트워크 주소 | 호스트 범위 | 브로드캐스트 | 게이트웨이 |
|------|--------|-------------|------------|-------------|-----------|
| 영업팀 | /25 | 172.16.10.0/25 | .1 ~ .126 | 172.16.10.127 | .1 |
| 개발팀 | /26 | 172.16.10.128/26 | .129 ~ .190 | 172.16.10.191 | .129 |
| 관리팀 | /27 | 172.16.10.192/27 | .193 ~ .222 | 172.16.10.223 | .193 |
| 서버 팜 | /28 | 172.16.10.224/28 | .225 ~ .238 | 172.16.10.239 | .225 |
| WAN 1 | /30 | 172.16.10.240/30 | .241 ~ .242 | 172.16.10.243 | - |
| WAN 2 | /30 | 172.16.10.244/30 | .245 ~ .246 | 172.16.10.247 | - |
| WAN 3 | /30 | 172.16.10.248/30 | .249 ~ .250 | 172.16.10.251 | - |
| 여분 | - | 172.16.10.252/30 | - | - | - |

**검증:** 모든 서브넷이 겹치지 않고, 172.16.10.0/24 범위 안에 들어있습니다.

#### 라우터 설정

```
! 영업팀 VLAN
Router(config)# interface GigabitEthernet0/0.10
Router(config-subif)# encapsulation dot1Q 10
Router(config-subif)# ip address 172.16.10.1 255.255.255.128

! 개발팀 VLAN
Router(config)# interface GigabitEthernet0/0.20
Router(config-subif)# encapsulation dot1Q 20
Router(config-subif)# ip address 172.16.10.129 255.255.255.192

! 관리팀 VLAN
Router(config)# interface GigabitEthernet0/0.30
Router(config-subif)# encapsulation dot1Q 30
Router(config-subif)# ip address 172.16.10.193 255.255.255.224

! 서버 팜
Router(config)# interface GigabitEthernet0/0.40
Router(config-subif)# encapsulation dot1Q 40
Router(config-subif)# ip address 172.16.10.225 255.255.255.240

! WAN 링크 1
Router(config)# interface Serial0/0/0
Router(config-if)# ip address 172.16.10.241 255.255.255.252
```

---

### 면접관: "경로 요약(Route Summarization)을 할 때 주의할 점은 무엇인가요? 잘못된 요약의 예를 들어 주세요."

경로 요약 시 가장 중요한 주의점은 요약된 경로가 **의도하지 않은 네트워크를 포함하지 않도록** 하는 것입니다.

#### 올바른 요약 예시

```
요약 대상 네트워크:
10.1.0.0/24
10.1.1.0/24
10.1.2.0/24
10.1.3.0/24

이진수 분석 (세 번째 옥텟):
10.1.00000000.0  (0)
10.1.00000001.0  (1)
10.1.00000010.0  (2)
10.1.00000011.0  (3)
     ^^^^^^
     공통 비트: 000000 (앞 6비트 동일)

올바른 요약: 10.1.0.0/22
→ 10.1.0.0 ~ 10.1.3.255만 포함 (정확!)
```

#### 잘못된 요약 예시

```
요약 대상 네트워크:
10.1.0.0/24
10.1.1.0/24
10.1.4.0/24   ← 연속되지 않음!

잘못된 요약: 10.1.0.0/21
→ 10.1.0.0 ~ 10.1.7.255 포함
→ 10.1.2.0, 10.1.3.0, 10.1.5.0, 10.1.6.0, 10.1.7.0 네트워크도
  포함되어 버림 → 라우팅 블랙홀 발생 가능!
```

**주의사항 정리:**

| 주의점 | 설명 |
|--------|------|
| 연속된 네트워크 | 요약할 네트워크는 연속된 범위여야 함 |
| 2의 거듭제곱 | 요약 가능한 네트워크 수는 2, 4, 8, 16... |
| 블랙홀 방지 | 요약 범위에 존재하지 않는 네트워크가 포함되면 패킷이 손실될 수 있음 |
| Null 라우트 | 요약 경로 사용 시 Null0 경로를 추가하여 루프 방지 |

```
! 요약 경로와 함께 Null0 경로 설정 (라우팅 루프 방지)
Router(config)# ip route 10.1.0.0 255.255.252.0 10.0.0.2
Router(config)# ip route 10.1.0.0 255.255.252.0 Null0 254
! AD 254로 설정하여 정상 경로보다 우선순위 낮게 설정
```

---

### 면접관: "VLSM을 지원하는 라우팅 프로토콜과 지원하지 않는 프로토콜의 차이를 설명해 주세요."

VLSM 지원 여부는 라우팅 프로토콜이 **서브넷 마스크 정보를 라우팅 업데이트에 포함하는지**에 따라 결정됩니다.

| 구분 | 클래스풀 프로토콜 | 클래스리스 프로토콜 |
|------|-----------------|-------------------|
| 서브넷 마스크 전송 | X (포함하지 않음) | O (포함함) |
| VLSM 지원 | X | O |
| CIDR 지원 | X | O |
| 경로 요약 | 자동 (클래스 경계에서) | 수동/자동 선택 가능 |
| 대표 프로토콜 | RIPv1, IGRP | **RIPv2, OSPF, EIGRP, BGP, IS-IS** |

**클래스풀 프로토콜의 문제:**

RIPv1은 서브넷 마스크 정보를 전송하지 않기 때문에, 수신 측에서 클래스 기본 마스크를 사용하여 해석합니다.

```
예시 문제:
Router A가 172.16.10.0/24를 광고하려 함
RIPv1은 마스크를 보내지 않음 → 172.16.10.0만 전송
수신 Router B는 Class B 기본 마스크 적용 → 172.16.0.0/16으로 해석

→ 의도한 /24가 아닌 /16으로 인식되어 라우팅 오류 발생!
```

**클래스리스 프로토콜의 장점:**

```
! RIPv2는 서브넷 마스크를 포함하여 업데이트 전송
Router(config)# router rip
Router(config-router)# version 2
Router(config-router)# no auto-summary   ! 자동 요약 비활성화
Router(config-router)# network 172.16.0.0

! OSPF도 클래스리스 지원
Router(config)# router ospf 1
Router(config-router)# network 172.16.10.0 0.0.0.255 area 0
```

`no auto-summary` 명령이 중요한 이유는, RIPv2와 EIGRP는 기본적으로 클래스 경계에서 자동 요약을 수행하기 때문입니다. 이를 비활성화해야 VLSM이 제대로 동작합니다.

---

### 면접관: "ISP가 고객에게 IP를 할당하는 시나리오에서 CIDR가 어떻게 활용되는지 설명해 주세요."

ISP는 CIDR를 활용하여 IP 주소를 계층적으로 할당하고, 라우팅 테이블을 효율적으로 관리합니다.

**시나리오: ISP가 203.0.113.0/24 블록을 보유**

```
ISP 보유 주소: 203.0.113.0/24 (256개)

고객 A (대기업): 100개 IP 필요 → /25 할당
고객 B (중소기업): 50개 IP 필요 → /26 할당
고객 C (소기업): 25개 IP 필요 → /27 할당
고객 D (소기업): 10개 IP 필요 → /28 할당
나머지: 향후 할당을 위해 보관
```

| 고객 | 할당 서브넷 | 범위 | 사용 가능 IP |
|------|-----------|------|------------|
| 고객 A | 203.0.113.0/25 | .0 ~ .127 | 126개 |
| 고객 B | 203.0.113.128/26 | .128 ~ .191 | 62개 |
| 고객 C | 203.0.113.192/27 | .192 ~ .223 | 30개 |
| 고객 D | 203.0.113.224/28 | .224 ~ .239 | 14개 |
| 여분 | 203.0.113.240/28 | .240 ~ .255 | 14개 |

**CIDR의 라우팅 효율성:**

ISP의 상위 라우터(인터넷 백본)에서는 고객 A, B, C, D의 개별 경로를 알 필요 없이, ISP 전체를 하나의 요약 경로로 처리합니다.

```
인터넷 백본 라우터:
  203.0.113.0/24 → ISP 라우터로 전달

ISP 라우터 (세부 경로 보유):
  203.0.113.0/25   → 고객 A
  203.0.113.128/26 → 고객 B
  203.0.113.192/27 → 고객 C
  203.0.113.224/28 → 고객 D
```

이러한 계층적 할당 덕분에 인터넷 전체 라우팅 테이블의 크기를 관리 가능한 수준으로 유지할 수 있습니다. CIDR 없이는 인터넷 라우팅 테이블이 수억 개의 항목으로 폭발적으로 증가했을 것입니다.

```
! ISP 라우터 설정 예시
ISP-Router(config)# ip route 203.0.113.0 255.255.255.128 10.0.0.2     ! 고객 A
ISP-Router(config)# ip route 203.0.113.128 255.255.255.192 10.0.1.2   ! 고객 B
ISP-Router(config)# ip route 203.0.113.192 255.255.255.224 10.0.2.2   ! 고객 C
ISP-Router(config)# ip route 203.0.113.224 255.255.255.240 10.0.3.2   ! 고객 D

! 상위 ISP에게는 요약 경로만 광고
ISP-Router(config)# router bgp 65001
ISP-Router(config-router)# network 203.0.113.0 mask 255.255.255.0
```

VLSM과 CIDR는 현대 네트워크의 근간을 이루는 핵심 기술이며, 이를 이해하는 것은 네트워크 엔지니어의 기본 역량입니다.
