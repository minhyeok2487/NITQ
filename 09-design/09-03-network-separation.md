# 09-03. 망분리 설계

---

## 면접관: "공공기관에서 망분리 구축 사업 RFP가 나왔습니다. 직원 500명 규모이고, 인터넷 업무와 내부 업무를 분리해야 합니다. 어떻게 설계하시겠어요?"

망분리(Network Separation/Segregation)는 크게 **물리적 망분리**와 **논리적 망분리** 두 가지 방식으로 접근할 수 있습니다. 공공기관 특성상 법적 요건을 먼저 확인하겠습니다.

### 설계 옵션 비교

#### Option A: 물리적 망분리

```
[사용자 PC-1 (업무용)] ─── [업무망 스위치] ─── [업무망 서버팜]
                                                    (인터넷 연결 없음)

[사용자 PC-2 (인터넷용)] ─── [인터넷망 스위치] ─── [인터넷 라우터] ─── Internet
```

- **네트워크 장비, 케이블, PC를 완전히 별도로 구축**
- 사용자 책상에 PC 2대 (업무용 + 인터넷용)
- 업무망과 인터넷망은 물리적으로 어떠한 접점도 없음
- **장점**: 최고 수준 보안, 감사/규제 대응 용이
- **단점**: 비용 2배, 책상 공간 부족, 사용자 불편

#### Option B: 논리적 망분리 (VDI 기반)

```
[사용자 PC (업무용)] ─── [업무망 스위치] ─── [업무망 서버팜]
       │
       └─ VDI Client ──→ [VDI 서버팜] ─── [인터넷 라우터] ─── Internet
```

- 물리 PC는 업무망에만 연결
- 인터넷 접속은 **VDI(Virtual Desktop Infrastructure)** 가상 데스크탑으로
- 실제 인터넷 트래픽은 VDI 서버에서 발생, 사용자 PC에는 화면만 전달
- **장점**: PC 1대로 운영, 비용 절감, 공간 효율
- **단점**: VDI 서버팜 투자 필요, VDI 성능 이슈

### 권장 설계: 이 공공기관에는?

- **국가정보원 가이드라인 + 개인정보보호법**에 따라 공공기관은 **물리적 망분리가 원칙**
- 다만 예산/공간 제약 시 **VDI 기반 논리적 망분리**도 인정 (정보보호 수준 검증 후)
- 500명 규모면 물리적 망분리의 비용 부담이 크므로, **VDI 기반 논리적 망분리를 1차 제안**하되, 감사 요건에 따라 물리적 망분리 병행 가능하다고 제시

> 토폴로지 이미지 추가 예정

---

## 면접관: "망분리 관련 법적 요건을 좀 더 구체적으로 설명해주세요. 어떤 법에 근거하고, 어떤 기관이 대상인가요?"

### 주요 법적 근거

#### 1. 국가사이버안보기본법 / 국가정보보안기본지침 (국정원)

- **대상**: 중앙행정기관, 지방자치단체, 공공기관
- **요건**: 업무망과 인터넷망의 분리 의무
- 국정원 CC(Common Criteria) 인증 제품 사용 권장
- **물리적 분리가 원칙**, 논리적 분리 시 국정원 검증 필요

#### 2. 개인정보보호법 시행령

- **대상**: 개인정보를 처리하는 모든 기관/기업
- 제48조: 개인정보처리시스템에 대한 접근 통제
- 10만 명 이상 개인정보 처리 시 **인터넷망 분리** 의무

#### 3. 전자금융감독규정 (금융위원회)

- **대상**: 은행, 증권사, 보험사 등 전 금융기관
- 제15조: 정보처리시스템과 해킹 등 방지 대책
- **"전산실 내부 통신망을 인터넷 등 외부 통신망과 분리"** 명시
- **가장 엄격**: 물리적 망분리 사실상 의무

#### 4. 정보통신망법 (ISMS-P 인증)

- ISMS-P 인증 기준 중 접근 통제 항목에서 망분리 요구
- 일일 평균 이용자 100만 명 이상 또는 매출 100억 이상 정보통신서비스 제공자

### 기관/업종별 요약

| 구분 | 망분리 의무 | 수준 |
|------|------------|------|
| 중앙/지방 공공기관 | 의무 | 물리적 원칙, 논리적 허용(검증 시) |
| 금융기관 | 의무 | 물리적 망분리 사실상 필수 |
| 개인정보처리자 (10만 건+) | 의무 | 물리적 또는 논리적 |
| 일반 기업 | 권장 | 자율 |

---

## 면접관: "물리적 망분리와 논리적 망분리를 좀 더 기술적으로 비교해주세요. 논리적 망분리에는 어떤 방식들이 있나요?"

### 물리적 망분리 (Physical Separation)

```
[업무 PC] ─── [업무 스위치] ─── [업무 라우터] ─── [업무 서버팜]
                                                    (No Internet)
[인터넷 PC] ─── [인터넷 스위치] ─── [인터넷 라우터] ─── [Internet]
```

- 스위치, 라우터, 케이블, PC 모두 **완전히 별도**
- 두 망 사이에 어떤 논리적/물리적 연결도 없음
- USB, 외장 HDD 등 매체 반출입도 통제

**기술적 구현 시 주의점**:
- 스위치에 VLAN으로 분리하는 것은 물리적 망분리가 **아님**
- 같은 스위치의 다른 포트에 연결해도 물리적 분리가 **아님**
- 반드시 **별도 장비**를 사용해야 물리적 분리로 인정

### 논리적 망분리 방식

#### 방식 1: VDI (Virtual Desktop Infrastructure) 기반

```
[물리 PC (업무망)] ─── [업무 스위치] ─── [업무 서버팜]
       │
       └─ VDI 클라이언트 ──(화면 전송)──→ [VDI 서버] ─── [인터넷]
```

- 물리 PC에서는 업무만 수행
- 인터넷 접속 시 VDI 가상머신 사용 (화면만 전달, ICA/PCoIP 프로토콜)
- **대표 솔루션**: VMware Horizon, Citrix XenDesktop, MS RDS
- 인터넷 트래픽은 VDI 서버에서 발생 → 물리 PC와 격리

#### 방식 2: CBC (Client Based Computing) 기반

```
[물리 PC]
 ├─ [업무 영역 (보안 OS)] ─── [업무망]
 └─ [인터넷 영역 (가상 OS)] ─── [인터넷망]
```

- PC 1대에서 가상화로 업무/인터넷 영역 분리
- 호스트 OS와 게스트 OS 간 클립보드, 파일 공유 차단
- **대표 솔루션**: VMware ACE, 한글과컴퓨터 Secure OS

#### 방식 3: SBC (Server Based Computing) 기반

- VDI와 유사하지만, 세션 기반 (가상 데스크탑이 아닌 가상 세션)
- 여러 사용자가 하나의 서버 OS를 세션 단위로 공유
- 비용 효율적이나 사용자 간 격리 수준이 VDI보다 낮음

### 비교표

| 구분 | 물리적 | VDI | CBC | SBC |
|------|--------|-----|-----|-----|
| 보안 수준 | 최상 | 상 | 중상 | 중 |
| 비용 | 최고 (장비 2배) | 고 (서버팜 투자) | 중 (S/W 라이선스) | 중하 |
| 사용자 편의 | 하 (PC 2대) | 중 (VDI 지연) | 중상 (PC 1대) | 중 |
| 관리 복잡도 | 고 (장비 2배 관리) | 고 (VDI 인프라) | 중 | 중 |
| 법적 인정 | 완전 인정 | 검증 시 인정 | 제한적 | 제한적 |

---

## 면접관: "망분리를 구축했더니 직원들 민원이 폭주합니다. '인터넷에서 자료 다운받아서 업무망으로 옮길 수가 없다', '외부 이메일 첨부파일을 업무에 쓸 수 없다'... 어떻게 해결하나요?"

이것이 망분리 사업의 **가장 큰 현실적 과제**입니다. 보안과 업무 효율의 균형을 맞추기 위해 **망연계(Network Bridge) 솔루션**을 도입합니다.

### 망연계 솔루션 개념

업무망과 인터넷망 사이에 **통제된 경로**를 만들어, 승인된 파일/데이터만 전달하는 시스템입니다.

```
[인터넷망] ─── [망연계 솔루션] ─── [업무망]
                    │
              ┌─────┴─────┐
              │  검증 엔진  │
              │ - 악성코드  │
              │ - 파일 형식 │
              │ - 결재 승인 │
              └───────────┘
```

### 망연계 방식

#### 1. 스트림(Stream) 방식

- 파일을 바이트 스트림으로 분해하여 전달
- 전달 과정에서 실행파일(EXE, DLL 등) 차단
- 허용된 파일 형식(HWP, DOCX, PDF, JPG 등)만 통과
- **속도**: 빠름 (실시간에 가까움)

#### 2. 망간 자료전송 시스템

- 사용자가 파일 업로드 → 상급자 결재 → 악성코드 검사 → 상대 망으로 전달
- **결재 프로세스**가 포함되어 감사 추적(audit trail) 가능
- **대표 솔루션**: 소프트캠프 SHIELDEX, 지니안 Genian CrossNet

### 구현 예시

```
[파일 전송 프로세스]
1. 사용자가 인터넷망에서 파일 다운로드
2. 망연계 시스템에 파일 업로드
3. 자동 악성코드 검사 (멀티 AV 엔진)
4. 파일 형식 검증 (매크로 포함 문서 차단 옵션)
5. CDR(Content Disarm & Reconstruction) 처리
6. 상급자 결재 (정책에 따라 자동/수동)
7. 업무망으로 파일 전달
8. 전체 과정 로깅 → 감사 증적
```

### CDR (Content Disarm & Reconstruction)

- 파일 내부의 **악성 매크로, 스크립트, OLE 객체 등을 제거**하고 깨끗한 파일로 재구성
- 예: Excel 파일 → 매크로 제거 → 데이터만 있는 깨끗한 Excel로 재생성
- 망연계 시 CDR을 적용하면 알려지지 않은 악성코드(Zero-day)도 방어 가능

### 사용자 불편 최소화 방안

1. **자주 쓰는 사이트 화이트리스트**: 정부 사이트, 학술 DB 등은 업무망에서 직접 접근 허용 (프록시 경유)
2. **클립보드 제한 완화**: 텍스트만 복사 허용, 파일/이미지는 차단
3. **망연계 결재 간소화**: 일정 용량(예: 10MB) 이하 허용 파일은 자동 승인
4. **사용자 교육**: 망분리 필요성과 망연계 사용법 교육

---

## 면접관: "VDI 기반 망분리를 좀 더 깊이 설명해주세요. VDI 서버팜은 어느 망에 두고, 네트워크 설계는 어떻게 하나요?"

### VDI 기반 망분리 네트워크 설계

#### 아키텍처

```
┌─────────────────────────────────────────────────┐
│                   업무망 (Trust)                  │
│                                                   │
│  [사용자 PC] ─── [업무 스위치] ─── [업무 서버팜]   │
│       │                                           │
│       │ (PCoIP/ICA 프로토콜)                       │
│       │                                           │
│  ─────┼───────────── 망분리 경계 ──────────────── │
│       │                                           │
│       ▼                                           │
│  [VDI Connection Broker]                          │
│       │                                           │
│  [VDI 서버팜] ─── [인터넷 스위치] ─── [Internet]   │
│                                                   │
│                인터넷망 (Untrust)                   │
└─────────────────────────────────────────────────┘
```

#### 네트워크 구성 상세

**VDI 서버팜 위치**: 인터넷망에 배치

- VDI 가상 데스크탑에서 실제 인터넷 트래픽이 발생하므로, VDI 서버팜은 **인터넷망**에 위치
- 사용자 PC(업무망)에서 VDI 서버로는 **화면 전송 프로토콜만** 통과

```
! 업무망 → VDI 서버 허용 룰 (방화벽 또는 ACL)
! PCoIP: UDP 4172, TCP 4172
! ICA: TCP 1494, TCP 2598
! RDP: TCP 3389 (MS 환경)

access-list WORK-TO-VDI permit udp 10.1.0.0 0.0.255.255 172.16.100.0 0.0.0.255 eq 4172
access-list WORK-TO-VDI permit tcp 10.1.0.0 0.0.255.255 172.16.100.0 0.0.0.255 eq 4172
access-list WORK-TO-VDI deny ip 10.1.0.0 0.0.255.255 172.16.0.0 0.0.255.255
```

#### VDI 성능 설계 고려

- **대역폭**: 사용자당 약 200Kbps~2Mbps (일반 업무), 동영상 시 5~10Mbps
- 500명 동시 접속: 약 500Mbps~1Gbps 필요 (VDI 전용 대역)
- **지연(Latency)**: 20ms 이하 유지 (화면 체감 품질)
- **서버 스펙**: vCPU 2개, RAM 4GB per 가상 데스크탑 기준
  - 500명: 약 250 vCPU, 2TB RAM → 물리 서버 약 10~15대

#### QoS 설계

VDI 프로토콜 트래픽을 우선 처리하여 사용자 체감 품질을 보장합니다.

```
! QoS: VDI 트래픽 우선 처리
class-map match-any VDI-TRAFFIC
 match protocol pcoip
 match access-group name VDI-ACL
!
policy-map VDI-QOS
 class VDI-TRAFFIC
  bandwidth percent 40
  set dscp af31
 class class-default
  bandwidth percent 60
!
interface GigabitEthernet0/1
 service-policy output VDI-QOS
```

---

## 면접관: "망분리 후 가장 골치 아픈 문제 중 하나가 '업무망 서버의 패치/업데이트 관리'라고 들었어요. 인터넷이 안 되는데 어떻게 패치하죠?"

맞습니다. 망분리 환경에서 가장 빈번하게 발생하는 운영 이슈입니다.

### 문제 상황

- 업무망 서버/PC는 인터넷 연결이 없음
- Windows Update, 백신 업데이트, 소프트웨어 패치 등 인터넷 접속 필요
- 패치를 안 하면 **보안 취약점이 누적** → 내부 공격에 취약
- 패치를 위해 인터넷을 연결하면 **망분리 원칙 위반**

### 해결 방안

#### 1. WSUS/SCCM 미러 서버 운영 (Windows 환경)

```
[인터넷] ─── [인터넷망 WSUS 서버] ──(망연계)──→ [업무망 WSUS 서버] ─── [업무망 PC]
```

1. 인터넷망 WSUS 서버가 Microsoft에서 업데이트 다운로드
2. 망연계 시스템을 통해 업데이트 파일을 업무망 WSUS로 전달
3. 업무망 PC/서버는 업무망 WSUS에서 업데이트 수신

```
! 업무망 PC GPO 설정 (WSUS 서버 지정)
Computer Configuration → Administrative Templates → Windows Components
  → Windows Update → Specify intranet Microsoft update service location
  → http://wsus-internal.corp.local:8530
```

#### 2. 오프라인 패치 저장소 (Linux 환경)

```
# 인터넷망에서 리포지토리 미러링
rsync -avz rsync://mirror.kakao.com/centos/ /repo/centos/

# 망연계를 통해 업무망 로컬 리포지토리 서버로 전달

# 업무망 서버의 yum repo 설정
[local-repo]
name=Internal Repository
baseurl=http://repo-internal.corp.local/centos/
enabled=1
gpgcheck=1
```

#### 3. 백신 업데이트

```
[인터넷] ─── [백신 중앙관리 서버 (인터넷)] ──(망연계)──→ [백신 중앙관리 서버 (업무)] ─── [업무 PC]
```

- 백신 패턴(시그니처) 파일을 망연계로 전달
- 대부분의 기업 백신(V3, 알약, CrowdStrike 등)은 오프라인 패턴 배포 지원
- **패턴 파일도 CDR/무결성 검증 후 전달**

#### 4. 자동화 파이프라인 구축

```
[패치 관리 프로세스]
매일 02:00 - 인터넷망 패치 서버가 벤더 사이트에서 패치 수집
매일 03:00 - 자동 악성코드 검사 + 무결성 검증(해시 비교)
매일 04:00 - 망연계를 통해 업무망 패치 서버로 전달
매일 05:00 - 테스트 그룹(10대)에 자동 배포
테스트 통과 후 - 전체 업무망 배포 (단계적 롤아웃)
```

### 추가 고려사항

| 항목 | 설명 |
|------|------|
| **3rd Party 소프트웨어** | Adobe, Java 등은 SCCM 또는 별도 배포 시스템으로 관리 |
| **긴급 패치 (Zero-day)** | 긴급 시 결재 프로세스 간소화, 핫라인 구성 |
| **패치 롤백** | 업무망 서버 스냅샷 → 패치 적용 → 문제 시 롤백 |
| **감사 증적** | 패치 적용 일시, 대상, 결과 전부 로깅 → 감사 대응 |
| **에어갭 환경** | 극단적 보안 환경에서는 USB/외장 HDD로 수동 전달 (매체 통제 필수) |

패치 미적용으로 인한 보안 사고가 망분리 자체보다 더 큰 리스크가 될 수 있습니다. **"망분리를 했으니 안전하다"는 착각이 가장 위험**하며, 내부 위협(insider threat)과 패치 미적용 취약점 관리가 망분리 환경의 핵심 과제입니다.
